---
import PageLayout from '@layouts/PageLayout.astro';
import Container from '@components/ui/Container.astro';
import Card from '@components/ui/Card.astro';
import Badge from '@components/ui/Badge.astro';
import NewsletterSignup from '@components/sections/NewsletterSignup.astro';
import { getCollection } from 'astro:content';

// Get all articles sorted by date
const articles = await getCollection('articles');
const sortedArticles = articles.sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-AU', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(date);
}
---

<PageLayout
  title="Articles | Rebekah Campbell"
  description="Articles and insights from Rebekah Campbell on entrepreneurship, relationships, and building a meaningful life."
>
  <!-- Hero Section -->
  <section class="bg-white py-16 sm:py-20">
    <Container>
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="font-display text-4xl font-medium text-neutral-900 sm:text-5xl">
          Articles
        </h1>
        <p class="mt-6 text-lg text-neutral-900/70">
          Honest insights on entrepreneurship, relationships, and building a life of purpose. No fluff, no guru nonsense.
        </p>
      </div>
    </Container>
  </section>

  <!-- Articles Grid -->
  <section class="bg-neutral-50 py-16 sm:py-20">
    <Container>
      {sortedArticles.length > 0 ? (
        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {sortedArticles.map((article) => (
            <Card padding="none" hover href={`/articles/${article.slug}/`}>
              {article.data.image && (
                <img
                  src={article.data.image}
                  alt={article.data.title}
                  class="w-full h-48 object-cover rounded-t-xl"
                  loading="lazy"
                />
              )}
              <div class="p-6">
                {article.data.tags && article.data.tags.length > 0 && (
                  <div class="flex gap-2 mb-3">
                    {article.data.tags.slice(0, 2).map((tag) => (
                      <Badge variant="secondary" size="sm">{tag}</Badge>
                    ))}
                  </div>
                )}
                <h2 class="font-display text-xl font-medium text-neutral-900 mb-2">
                  {article.data.title}
                </h2>
                <p class="text-neutral-900/70 text-sm mb-4 line-clamp-3">
                  {article.data.description}
                </p>
                <p class="text-sm text-neutral-900/50">
                  {formatDate(article.data.publishDate)}
                </p>
              </div>
            </Card>
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-lg text-neutral-900/70 mb-8">
            Articles are being migrated. In the meantime, you can read Rebekah's columns at The New York Times and AFR BOSS.
          </p>
          <div class="flex flex-wrap justify-center gap-4">
            <a
              href="https://www.nytimes.com/"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary-600 hover:text-primary-700 font-medium"
            >
              The New York Times
            </a>
            <span class="text-neutral-900/30">|</span>
            <a
              href="https://www.afr.com/"
              target="_blank"
              rel="noopener noreferrer"
              class="text-primary-600 hover:text-primary-700 font-medium"
            >
              AFR BOSS
            </a>
          </div>
        </div>
      )}
    </Container>
  </section>

  <!-- Newsletter -->
  <NewsletterSignup
    title="Get New Articles in Your Inbox"
    description="Subscribe to receive weekly insights on entrepreneurship, relationships, and building a meaningful life."
  />
</PageLayout>
